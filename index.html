<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>请求构建</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 400px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }
        input[type="text"], select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        label {
            font-weight: bold;
        }
        .message {
            margin-top: 10px;
            color: red;
        }
        .response {
            margin-top: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #ccc;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:disabled {
            background-color: #cccccc;
        }
        .header-input, .body-input {
            margin: 10px 0;
        }
        #bodyInputContainer {
            display: none; /* 默认隐藏请求体输入框 */
        }
    </style>
</head>
<body>

<div class="container">
    <h2>请求类型选择</h2>
    
    <label for="requestType">请选择请求类型：</label>
    <select id="requestType" name="requestType" onchange="toggleBodyInput()">
        <option value="GET">GET</option>
        <option value="POST">POST</option>
        <option value="PUT">PUT</option>
        <option value="DELETE">DELETE</option>
    </select>

    <label for="urlInput">请输入URL：</label>
    <input type="text" id="urlInput" placeholder="输入完整的URL...">
    
    <label for="headerInput">请输入请求头（格式：key:value，多个用分号分隔）：</label>
    <input type="text" id="headerInput" class="header-input" placeholder="例如：Authorization:Bearer token;Content-Type:application/json">

    <div id="bodyInputContainer">
        <label for="bodyInput">请输入请求体（JSON格式）：</label>
        <input type="text" id="bodyInput" class="body-input" placeholder='例如：{"key":"value"}'>
    </div>

    <div class="message" id="message"></div>
    <button id="submitButton" onclick="submitRequest()">提交</button>

    <div class="response" id="responseDisplay" style="display:none;"></div>
</div>

<script>
    function isValidURL(string) {
        const urlPattern = new RegExp('^(https?:\\/\\/)?' + // protocol
            '((([a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)\\.)+' + // domain name
            '([a-z]{2,6}|[a-z0-9-]{2,})|' + // OR ip (v4) address
            'localhost|' + // OR localhost...
            '\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}|' + // OR ipv4
            '\\[?[a-f0-9]*:[a-f0-9:%.~%!$&\'()*+,;=\\/?]+\\]?)' + // OR ipv6
            '(\\:\\d+)?(\\/[-a-z0-9+&@#/%=~_|!:,.;]*[a-z0-9+&@#/%=~_|])?$', 'i'); // path
        return !!urlPattern.test(string);
    }

    function parseHeaders(headerString) {
        const headers = {};
        const headerPairs = headerString.split(';');
        headerPairs.forEach(pair => {
            const [key, value] = pair.split(':').map(item => item.trim());
            if (key && value) {
                headers[key] = value;
            }
        });
        return headers;
    }

    function toggleBodyInput() {
        const requestType = document.getElementById('requestType').value;
        const bodyInputContainer = document.getElementById('bodyInputContainer');

        // 仅在POST和PUT请求时显示请求体输入框
        if (requestType === 'POST' || requestType === 'PUT') {
            bodyInputContainer.style.display = 'block';
        } else {
            bodyInputContainer.style.display = 'none';
        }
    }

    function showMessage(text) {
        const message = document.getElementById('message');
        message.textContent = text;
        // 三秒后自动清空提示信息
        setTimeout(() => {
            message.textContent = '';
        }, 3000);
    }

    function submitRequest() {
        const url = document.getElementById('urlInput').value;
        const requestType = document.getElementById('requestType').value;
        const headerInput = document.getElementById('headerInput').value;
        const bodyInput = document.getElementById('bodyInput').value;
        const message = document.getElementById('message');
        const responseDisplay = document.getElementById('responseDisplay');

        // 清空提示信息和响应内容
        message.textContent = '';
        responseDisplay.textContent = '';
        responseDisplay.style.display = 'none';

        // 验证URL是否有效
        if (!url || !isValidURL(url)) {
            showMessage('请输入有效的URL。');
            return;
        }

        // 解析请求头
        const headers = parseHeaders(headerInput);

        // 根据请求类型发送请求
        let options = {
            method: requestType,
            headers: {
                ...headers,
                'Content-Type': 'application/json',
            },
        };

        // 对于POST和PUT请求，设置请求体
        if (requestType === 'POST' || requestType === 'PUT') {
            options.body = bodyInput ? bodyInput : '{}'; // 使用用户输入的请求体，若为空则使用空对象
        }

        fetch(url, options)
            .then(response => {
                if (!response.ok) {
                    throw new Error('网络错误：' + response.status);
                }
                return response.text();
            })
            .then(data => {
                showMessage(`${requestType} 请求成功！`);
                responseDisplay.textContent = data;
                responseDisplay.style.display = 'block'; // 显示响应数据
                console.log(data);
            })
            .catch(error => {
                showMessage('请求失败：' + error.message);
            });
    }
</script>

</body>
</html>
